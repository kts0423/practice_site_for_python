<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ê´€ë¦¬ì íˆìŠ¤í† ë¦¬</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='dark.css') }}">
</head>
<body>
<div class="container">
    <h1>ğŸ‘¨â€ğŸ’¼ ê´€ë¦¬ì íˆìŠ¤í† ë¦¬ ({{ user.name }})</h1>
    <p><a href="/">â† ë©”ì¸ìœ¼ë¡œ</a></p>

    <form method="get" action="{{ url_for('admin_history') }}" style="margin-bottom: 20px;">
        <label>ì¹´í…Œê³ ë¦¬:</label>
        <input type="text" name="category" value="{{ category_filter or '' }}">
        <label style="margin-left: 20px;">ì‹œì‘ì¼:</label>
        <input type="date" name="start" value="{{ start_date or '' }}">
        <label style="margin-left: 10px;">ì¢…ë£Œì¼:</label>
        <input type="date" name="end" value="{{ end_date or '' }}">
        <button type="submit">ğŸ” í•„í„°</button>
    </form>

    <p>ì´ ë¬¸ì œ ìˆ˜: {{ total }} | ì •ë‹µ ìˆ˜: {{ correct }} | ì •ë‹µë¥ : {{ '%.0f' % ((correct / total * 100) if total else 0) }}%</p>

    <canvas id="adminChart"
            width="400"
            height="200"
            data-correct="{{ correct }}"
            data-total="{{ total }}">
    </canvas>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        const canvas = document.getElementById('adminChart');
        const correct = parseInt(canvas.dataset.correct);
        const total = parseInt(canvas.dataset.total);

        const chart = new Chart(canvas.getContext('2d'), {
            type: 'doughnut',
            data: {
                labels: ['ì •ë‹µ', 'ì˜¤ë‹µ'],
                datasets: [{
                    data: [correct, total - correct],
                    backgroundColor: ['#00e676', '#ff5252'],
                    borderWidth: 1
                }]
            },
            options: {
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: { color: '#f1f1f1' }
                    }
                }
            }
        });
    </script>

    {% for item in records %}
        <div class="result-box">
            <strong>ì‚¬ìš©ì:</strong> {{ item.name }} ({{ item.student_id }})<br>
            <strong>ì œì¶œ ì‹œê°:</strong> {{ item.timestamp }}<br>
            <strong>ë¬¸ì œ:</strong> {{ item.problem }}<br><br>
            <strong>ì½”ë“œ:</strong><pre>{{ item.code }}</pre>
            <strong>ì¶œë ¥:</strong><pre>{{ item.output }}</pre>
            <strong>ê²°ê³¼:</strong>
            <span class="{{ 'correct' if item.is_correct else 'wrong' }}">
                {{ 'ì •ë‹µ' if item.is_correct else 'ì˜¤ë‹µ' }}
            </span>
        </div>
    {% else %}
        <p>ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</p>
    {% endfor %}
</div>
</body>
</html>
